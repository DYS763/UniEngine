$(document).ready(function(){libCommon.init.setupJQuery();const $targetCoordInputs={galaxy:$('input[name="galaxy"]'),system:$('input[name="system"]'),planet:$('input[name="planet"]')};var FlightDuration;function setTarget(galaxy,system,planet,type){$("#galaxy_selector").val(galaxy),$("#system_selector").val(system),$("#select_planet").val(planet),$("#type_selector").val(type)}function calculateFlightDistance(){var thisGalaxy=parseInt($("#ThisGalaxy").val(),10),thisSystem=parseInt($("#ThisSystem").val(),10),thisPlanet=parseInt($("#ThisPlanet").val(),10),targetGalaxy=parseInt($("#galaxy_selector").val(),10),targetSystem=parseInt($("#system_selector").val(),10),targetPlanet=parseInt($("#select_planet").val(),10),dist=0;return dist=targetGalaxy-thisGalaxy!=0?2e4*Math.abs(targetGalaxy-thisGalaxy):targetSystem-thisSystem!=0?95*Math.abs(targetSystem-thisSystem)+2700:targetPlanet-thisPlanet!=0?5*Math.abs(targetPlanet-thisPlanet)+1e3:5}function calculateFlightDuration(){var ret=Math.round((35e3/getFlightSpeedOption()*Math.sqrt(10*calculateFlightDistance()/getShipsMaxSpeed())+10)/getUniSpeedFactor());return FlightDuration=ret,!0===AllowCreateTimeCounters&&updateTimeCounters(),ret}function getShipsMaxSpeed(){return parseInt($("#MaxSpeed").val(),10)}function getFlightSpeedOption(){return parseFloat($(".setSpeed_Current").attr("data-speed"))}function getUniSpeedFactor(){return parseInt($("#SpeedFactor").val(),10)}function calculateFlightConsumption(){const flightDistance=calculateFlightDistance(),flightDuration=calculateFlightDuration(),uniSpeedFactor=getUniSpeedFactor(),totalConsumption=Object.entries(shipsDetails).reduce((accumulator,[_shipId,shipDetails])=>{const allShipsBaseConsumption=parseInt(shipDetails.totalConsumptionOfShipType,10),shipSpeed=parseInt(shipDetails.speed,10),finalSpeed=35e3/(flightDuration*uniSpeedFactor-10)*Math.sqrt(10*flightDistance/shipSpeed),allShipsConsumption=allShipsBaseConsumption*flightDistance/35e3*(finalSpeed/10+1)*(finalSpeed/10+1);return accumulator+allShipsConsumption},0);return Math.round(totalConsumption)+1}function getResourcesStorage(){return parseInt($("#Storage").val(),10)-calculateFlightConsumption()}function getFuelStorage(){return parseInt($("#FuelStorage").val(),10)}function getPlanetDeuterium(){return parseInt($("#PlanetDeuterium").val(),10)}function updateFlightDetails(){const durationPrettyTime=uniengine.common.prettyTime({seconds:calculateFlightDuration(),isDayConversionDisabled:!0}),fleetResourcesStorage=getResourcesStorage(),fuelConsumption=calculateFlightConsumption(),fleetFuelStorage=getFuelStorage(),fleetTotalStorage=fleetResourcesStorage+(fleetFuelStorage>=fuelConsumption?fuelConsumption:fleetFuelStorage),availableFuel=getPlanetDeuterium(),storageValueColor=fleetTotalStorage>=0?"lime":"red",consumptionValueColor=availableFuel<fuelConsumption?"red":fleetTotalStorage>=0?"lime":"orange",storageHTML=`<b class="${storageValueColor}">${libCommon.format.addDots(fleetTotalStorage)}</b>`,consumptionHTML=`<b class="${consumptionValueColor}">${libCommon.format.addDots(fuelConsumption)}</b>`;$("#duration").html(`${durationPrettyTime} h`),$("#distance").html(libCommon.format.addDots(calculateFlightDistance())),$("#storageShow").html(storageHTML),$("#consumption").html(consumptionHTML)}function updateTimeCounters(){const currentTimeFormatted=libCommon.format.formatDateToFlightEvent(0),reachTimeFormatted=libCommon.format.formatDateToFlightEvent(1e3*FlightDuration),backTimeFormatted=libCommon.format.formatDateToFlightEvent(2*FlightDuration*1e3);$("#curr_time").html(currentTimeFormatted),$("#reach_time").html(reachTimeFormatted),$("#comeback_time").html(backTimeFormatted)}$(".updateInfo:not(.fastLink, select, .setSpeed)").on("keyup",function(){const $element=$(this);if(!$element.isNonEmptyValue({isZeroAllowed:!0}))return;const inputName=$element.attr("name"),inputValue=$element.val();"galaxy"!=inputName&&"system"!=inputName&&"planet"!=inputName||(inputValue<1&&$element.val(1),inputValue>maxIs[inputName]&&$element.val(maxIs[inputName])),updateFlightDetails()}).on("change",function(){$(this).keyup()}).on("focus",function(){$(this).isNonEmptyValue()&&($(this).data("last_val",$(this).val()),$(this).val(""))}).on("blur",function(){!$(this).isNonEmptyValue()&&$(this).isNonEmptyDataSlot("last_val")&&($(this).val($(this).data("last_val")),$(this).data("last_val",""))}),$("select.updateInfo:not(.fastLink)").on("keyup",()=>{updateFlightDetails()}).on("change",()=>{updateFlightDetails()}),$(".setSpeed").click(function(){return $('input[name="speed"]').val($(this).attr("data-speed")),$(".setSpeed_Selected").removeClass("setSpeed_Selected"),$(this).addClass("setSpeed_Selected"),updateFlightDetails(),!1}).hover(function(){""!=$targetCoordInputs.galaxy.val()&&""!=$targetCoordInputs.system.val()&&""!=$targetCoordInputs.planet.val()&&($(".setSpeed_Current").removeClass("setSpeed_Current"),$(this).addClass("setSpeed_Current"),updateFlightDetails())},function(){""!=$targetCoordInputs.galaxy.val()&&""!=$targetCoordInputs.system.val()&&""!=$targetCoordInputs.planet.val()&&($(this).removeClass("setSpeed_Current"),$(".setSpeed_Selected").addClass("setSpeed_Current"),updateFlightDetails())}),$(".fastLink").on("keyup",function(){if("-"!==$(this).val()){var coordinates=$(this).val().split(",");setTarget(coordinates[0],coordinates[1],coordinates[2],coordinates[3]),updateFlightDetails()}var GetIDNum=$(this).attr("id").substr(6);GetIDNum="1"==GetIDNum?2:1,$("#fl_sel"+GetIDNum).val("-").attr("selected",!0)}).on("change",function(){$(this).keyup()}),$("#goBack").on("click",()=>{$("#thisForm").attr("action","fleet.php").prepend('<input type="hidden" name="gobackUsed" value="1"/>').submit()}),$("#thisForm").on("submit",()=>{Object.values($targetCoordInputs).forEach($element=>{!$element.isNonEmptyValue()&&$element.isNonEmptyDataSlot("last_val")&&($element.val($element.data("last_val")),$element.data("last_val",""))})}),$("th:not(.FBlock, .inv), .updateInfo").addClass("pad2"),$("[name=galaxy]").tipTip({delay:0,edgeOffset:8,content:JSLang.fl1_targetGalaxy}),$("[name=system]").tipTip({delay:0,edgeOffset:8,content:JSLang.fl1_targetSystem}),$("[name=planet]").tipTip({delay:0,edgeOffset:8,content:JSLang.fl1_targetPlanet}),setInterval(updateTimeCounters,250),updateFlightDetails()});