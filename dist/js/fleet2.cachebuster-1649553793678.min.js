var SetMaxNow=!1,LastStorageLowerTh0=!1,QuantumGateOptionModif=!1;$(document).ready(function(){libCommon.init.setupJQuery();var FlightDurationTarget=FlightDuration,FlightDurationGoback=FlightDuration;function createTimeCounters(){const reachTimeFormatted=libCommon.format.formatDateToFlightEvent(1e3*FlightDurationTarget),backTimeFormatted=libCommon.format.formatDateToFlightEvent(1e3*(FlightDurationTarget+FlightDurationGoback));$("#ReachTime").html(reachTimeFormatted),$("#BackTime").html(backTimeFormatted)}$.fn.setStorageShow=function(setVar){var AddColor="orange",RemColor="lime",RemColor2="red";setVar>0?(AddColor="lime",RemColor="orange"):setVar<0&&(AddColor="red",RemColor2="orange");var El=$("#FreeStorageShow");$("#FreeStorageShow").val(setVar).prettyInputBox().html($("#FreeStorageShow").val()),El.hasClass(RemColor)?$("#FreeStorageShow").removeClass(RemColor):El.hasClass(RemColor2)&&$("#FreeStorageShow").removeClass(RemColor2),El.hasClass(AddColor)||$("#FreeStorageShow").addClass(AddColor)},setInterval(createTimeCounters,250),$("[id^=setMax]:not(#setMaxAll)").click(function(){SetMaxNow=!0;var ElSelector='[name="resource'+$(this).attr("id").substr(6)+'"]';return $(ElSelector).val($(ElSelector).val()+1).change(),SetMaxNow=!1,!1}),$("[id^=setZero]:not(#setZeroAll)").click(function(){var ElSelector='[name="resource'+$(this).attr("id").substr(7)+'"]';return $(ElSelector).val("0").change(),!1}),$("#setMaxAll").click(function(){for(var Index in ResSortArrayAll)$("#setMax"+ResSortArrayAll[Index]).click()}),$("#setZeroAll").click(function(){for(var Index in ResSortArrayAll)$("#setZero"+ResSortArrayAll[Index]).click()}),$('[name^="resource"]').change(function(){var ThisID=$(this).attr("name").substr(8),LastValue=$(this).data("lastVal"),CurrentValue=parseInt(libCommon.normalize.removeNonDigit($(this).val()),10);if((void 0===LastValue||isNaN(LastValue)||LastValue<0)&&(LastValue=0),(isNaN(CurrentValue)||CurrentValue<0)&&(CurrentValue=0),CurrentValue!=LastValue||QuantumGateOptionModif){var MaxValue=parseInt($("#PlanetResource"+ThisID).val(),10);if(3==ThisID){var DeleteFromVal=parseInt($("#Consumption").val(),10);if($("#usequantumgate").is(":checked")){var SelectedMission=$('[name="mission"]:checked').val();void 0!==SelectedMission&&("1"==QuantumGateDeuteriumUse[SelectedMission]?(DeleteFromVal/=2,DeleteFromVal=Math.ceil(DeleteFromVal)):"2"==QuantumGateDeuteriumUse[SelectedMission]&&(DeleteFromVal=0))}(MaxValue-=DeleteFromVal)<0&&(MaxValue=0)}(CurrentValue>MaxValue||SetMaxNow)&&(CurrentValue=MaxValue);var FreeStorage=parseInt($("#FreeStorage").val(),10),LastValDiff=CurrentValue-LastValue;LastValDiff<0?FreeStorage-=LastValDiff:(LastValDiff>FreeStorage?(CurrentValue-=LastValDiff-FreeStorage,FreeStorage=0):LastValDiff==FreeStorage?FreeStorage=0:FreeStorage-=LastValDiff,CurrentValue<0&&(FreeStorage+=CurrentValue,CurrentValue=0,LastStorageLowerTh0=!0)),$(this).val(CurrentValue).prettyInputBox().data("lastVal",CurrentValue),$("#FreeStorage").val(FreeStorage).setStorageShow(FreeStorage)}else $(this).val()!=libCommon.normalize.removeNonDigit($(this).val())&&$(this).val(CurrentValue).prettyInputBox()}).keyup(function(){$(this).change()}).focus(function(){$(this).isNonEmptyValue({isZeroAllowed:!1})||$(this).val("")}).blur(function(){$(this).isNonEmptyValue({isZeroAllowed:!0})||$(this).val("0")}),$(".mSelect").change(function(){var NewStorageModifier=QuantumGateDeuteriumUse[$(".mSelect:checked").val()],ConsuptionModif_New=0,StorageModif_New=0,FlyTimeTargetModif,FlyTimeBackModif;if(void 0!==NewStorageModifier){switch(NewStorageModifier){case 0:StorageModif_New=0,ConsuptionModif_New=0,FlyTimeTargetModif=0,FlyTimeBackModif=0;break;case 1:StorageModif_New=parseInt($("#Consumption").val(),10),isNaN(StorageModif_New)?StorageModif_New=0:(StorageModif_New/=2,StorageModif_New=Math.ceil(StorageModif_New)),ConsuptionModif_New=StorageModif_New,StorageModif_New-=parseInt($("#FuelStorageReduceH").val(),10),FlyTimeTargetModif=1,FlyTimeBackModif=0;break;case 2:StorageModif_New=parseInt($("#Consumption").val(),10),isNaN(StorageModif_New)&&(StorageModif_New=0),ConsuptionModif_New=StorageModif_New,StorageModif_New-=parseInt($("#FuelStorageReduce").val(),10),FlyTimeTargetModif=1,FlyTimeBackModif=1;break;default:StorageModif_New=0,ConsuptionModif_New=0,FlyTimeTargetModif=0,FlyTimeBackModif=0;break}var ConsuptionModif_Old=$("#FuelUse").data("ConsuptionModif_Old"),ConsuptionVar_Now=$("#FuelUse").data("ConsuptionVar_Now");void 0===ConsuptionModif_Old&&(ConsuptionModif_Old=0),void 0===ConsuptionVar_Now&&(ConsuptionVar_Now=parseInt($("#Consumption").val(),10)),$("#usequantumgate").is(":checked")||(ConsuptionModif_New=0);var ConsuptionModif_Dif=ConsuptionModif_New-ConsuptionModif_Old;0!==ConsuptionModif_Dif&&(ConsuptionVar_Now-=ConsuptionModif_Dif,$("#FuelUse").html(libCommon.format.addDots(ConsuptionVar_Now)),$("#FuelUse").data("ConsuptionModif_Old",ConsuptionModif_New),$("#FuelUse").data("ConsuptionVar_Now",ConsuptionVar_Now));var Changed=!1,StorageModif_Old=$("#FreeStorage").data("StorageModif_Old");void 0===StorageModif_Old&&(StorageModif_Old=0),$("#usequantumgate").is(":checked")||(StorageModif_New=0);var StorageModif_Dif=StorageModif_New-StorageModif_Old;if(0!==StorageModif_Dif){var FreeStorage=parseInt($("#FreeStorage").val(),10)+StorageModif_Dif;$("#FreeStorage").data("StorageModif_Old",StorageModif_New),Changed=!0}if(Changed){if($("#FreeStorage").val(FreeStorage).setStorageShow(FreeStorage),QuantumGateOptionModif=!0,$("[name=resource3]").change(),LastStorageLowerTh0){LastStorageLowerTh0=!1;var ThisResID="1",NextResID="2";"met"==ResSortArrayNoDeu[0]&&(ThisResID="2",NextResID="1"),$("[name=resource"+ThisResID+"]").change(),LastStorageLowerTh0&&(LastStorageLowerTh0=!1,$("[name=resource"+NextResID+"]").change(),LastStorageLowerTh0=!1)}QuantumGateOptionModif=!1}$("#usequantumgate").is(":checked")||(FlyTimeBackModif=0,FlyTimeTargetModif=0),FlightDurationTarget=1==FlyTimeTargetModif?1:FlightDuration,FlightDurationGoback=1==FlyTimeBackModif?1:FlightDuration;var FlightTimeSecs=FlightDurationTarget,FlightTimeHour=Math.floor(FlightTimeSecs/3600);FlightTimeSecs-=3600*FlightTimeHour;var FlightTimeMins=Math.floor(FlightTimeSecs/60);FlightTimeSecs-=60*FlightTimeMins,FlightTimeMins<10&&(FlightTimeMins="0"+FlightTimeMins),FlightTimeSecs<10&&(FlightTimeSecs="0"+FlightTimeSecs),FlightTimeHour<10&&(FlightTimeHour="0"+FlightTimeHour);var SetFlightTimeShow=FlightTimeHour+":"+FlightTimeMins+":"+FlightTimeSecs;1==FlyTimeTargetModif&&0==FlyTimeBackModif?(FlightTimeSecs=FlightDurationGoback,FlightTimeSecs-=3600*(FlightTimeHour=Math.floor(FlightTimeSecs/3600)),FlightTimeSecs-=60*(FlightTimeMins=Math.floor(FlightTimeSecs/60)),FlightTimeMins<10&&(FlightTimeMins="0"+FlightTimeMins),FlightTimeSecs<10&&(FlightTimeSecs="0"+FlightTimeSecs),FlightTimeHour<10&&(FlightTimeHour="0"+FlightTimeHour),SetFlightTimeShow+=" h<br/>"+FlightTimeHour+":"+FlightTimeMins+":"+FlightTimeSecs,$(".flyTimeInfo").show(),$(".flyTimeNoInfo").hide()):($(".flyTimeInfo").hide(),$(".flyTimeNoInfo").show()),$("#FlightTimeShow").html(SetFlightTimeShow)}}),$("#usequantumgate").click(function(){"1"==NeedQuantumGate&&($(this).is(":checked")?$("#noDeutInfo").hide():$("#noDeutInfo").show()),$(".mSelect").change()}),("1"!=NeedQuantumGate||"1"==NeedQuantumGate&&1==$("#usequantumgate").is(":checked"))&&$("#noDeutInfo").hide(),$(".flyTimeInfo").tipTip({delay:0,maxWidth:250,edgeOffset:8,content:JSLang.fl2_FlyTimeInfo}),$(".planet").tipTip({delay:0,edgeOffset:8,content:JSLang.fl_coordplanet}),$(".moon").tipTip({delay:0,edgeOffset:8,content:JSLang.fl_coordmoon}),$(".debris").tipTip({delay:0,edgeOffset:8,content:JSLang.fl_coorddebris}),$(".flyTimeInfo").hide(),$("th:not(.FBlock, .inv, .QuantumInfo), #gTb td").addClass("pad2"),$("#InfoTable").find("th:not(.nfoInv)").addClass("nfoTH"),$("#InfoTable").find("th.inv").addClass("nfoInv"),$("#goBack").click(function(){$("#thisForm").attr("action","fleet1.php").prepend('<input type="hidden" name="gobackUsed" value="1"/>').submit()}),$("#thisForm").submit(function(){if($('[name="gobackUsed"]').length<=0&&!0===AllyPact_AttackWarn){var ThisMission=$('[name="mission"]:checked').val();if(1==ThisMission||2==ThisMission||9==ThisMission||10==ThisMission)return confirm(JSLang.confirm_allypact_attack)}}),!1===SetResources?"1"==$("#quickres").val()&&$("#setMaxAll").click():($('[name="resource1"]').val(SetResources.resource1).change(),$('[name="resource2"]').val(SetResources.resource2).change(),$('[name="resource3"]').val(SetResources.resource3).change()),!0===SelectQuantumGate&&($("#usequantumgate").click(),$(".mSelect").change())});