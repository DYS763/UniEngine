var SetMaxNow=!1,LastStorageLowerTh0=!1,QuantumGateOptionModif=!1;const aggressiveMissionTypes=[1,2,9,10];$(document).ready(function(){libCommon.init.setupJQuery();var FlightDurationTarget=FlightDuration,FlightDurationGoback=FlightDuration;function createTimeCounters(){const reachTimeFormatted=libCommon.format.formatDateToFlightEvent(1e3*FlightDurationTarget),backTimeFormatted=libCommon.format.formatDateToFlightEvent(1e3*(FlightDurationTarget+FlightDurationGoback));$("#ReachTime").html(reachTimeFormatted),$("#BackTime").html(backTimeFormatted)}$.fn.setStorageShow=function(setVar){const hasEnoughStorage=setVar>=0,hasExactlyStorage=0==setVar,$element=$("#FreeStorageShow");$element.val(setVar).prettyInputBox().html($element.val()).toggleClass("red",!hasEnoughStorage).toggleClass("orange",hasExactlyStorage).toggleClass("lime",hasEnoughStorage)};const isQuantumGateNeeded=()=>"1"==NeedQuantumGate,isQuantumGateUsed=()=>$("#usequantumgate").is(":checked");setInterval(createTimeCounters,250),$(".setMaxResource").click(function(){SetMaxNow=!0;const resourceKey=$(this).data("resourceKey"),elSelector=`[name="resource${resourceKey}"]`;return $(elSelector).val($(elSelector).val()+1).change(),SetMaxNow=!1,!1}),$(".setZeroResource").click(function(){const resourceKey=$(this).data("resourceKey"),elSelector=`[name="resource${resourceKey}"]`;return $(elSelector).val("0").change(),!1}),$("#setMaxAll").click(function(){ResSortArrayAll.forEach(resourceKey=>{$(`.setMaxResource[data-resource-key='${resourceKey}']`).click()})}),$("#setZeroAll").click(function(){ResSortArrayAll.forEach(resourceKey=>{$(`.setZeroResource[data-resource-key='${resourceKey}']`).click()})}),$('[name^="resource"]').change(function(){var ThisID=$(this).attr("name").substr(8),LastValue=$(this).data("lastVal"),CurrentValue=parseInt(libCommon.normalize.removeNonDigit($(this).val()),10);if((void 0===LastValue||isNaN(LastValue)||LastValue<0)&&(LastValue=0),(isNaN(CurrentValue)||CurrentValue<0)&&(CurrentValue=0),CurrentValue!=LastValue||QuantumGateOptionModif){var MaxValue=parseInt($("#PlanetResource"+ThisID).val(),10);if(3==ThisID){var DeleteFromVal=parseInt($("#Consumption").val(),10);if(isQuantumGateUsed()){var SelectedMission=$('[name="mission"]:checked').val();void 0!==SelectedMission&&("1"==QuantumGateDeuteriumUse[SelectedMission]?(DeleteFromVal/=2,DeleteFromVal=Math.ceil(DeleteFromVal)):"2"==QuantumGateDeuteriumUse[SelectedMission]&&(DeleteFromVal=0))}(MaxValue-=DeleteFromVal)<0&&(MaxValue=0)}(CurrentValue>MaxValue||SetMaxNow)&&(CurrentValue=MaxValue);var FreeStorage=parseInt($("#FreeStorage").val(),10),LastValDiff=CurrentValue-LastValue;LastValDiff<0?FreeStorage-=LastValDiff:(LastValDiff>FreeStorage?(CurrentValue-=LastValDiff-FreeStorage,FreeStorage=0):LastValDiff==FreeStorage?FreeStorage=0:FreeStorage-=LastValDiff,CurrentValue<0&&(FreeStorage+=CurrentValue,CurrentValue=0,LastStorageLowerTh0=!0)),$(this).val(CurrentValue).prettyInputBox().data("lastVal",CurrentValue),$("#FreeStorage").val(FreeStorage).setStorageShow(FreeStorage)}else $(this).val()!=libCommon.normalize.removeNonDigit($(this).val())&&$(this).val(CurrentValue).prettyInputBox()}).keyup(function(){$(this).change()}).focus(function(){const val=libCommon.normalize.removeNonDigit($(this).val());libCommon.tests.isNonEmptyValue(val,{isZeroAllowed:!1})||$(this).val("")}).blur(function(){const val=libCommon.normalize.removeNonDigit($(this).val());libCommon.tests.isNonEmptyValue(val,{isZeroAllowed:!0})||$(this).val("0")});const getQuantumGateModifiers=modifierType=>{if(1==modifierType){const flightConsumption=parseInt($("#Consumption").val(),10),fuelStorageReduceHalf=parseInt($("#FuelStorageReduceH").val(),10),consumptionModifier=Number.isNaN(flightConsumption)?0:Math.ceil(flightConsumption/2);return{storageModifier:consumptionModifier-fuelStorageReduceHalf,consumptionModifier,flightTimeToTarget:1,flightTimeBackToOrigin:0}}if(2==modifierType){const flightConsumption=parseInt($("#Consumption").val(),10),fuelStorageReduce=parseInt($("#FuelStorageReduce").val(),10),consumptionModifier=Number.isNaN(flightConsumption)?0:flightConsumption;return{storageModifier:consumptionModifier-fuelStorageReduce,consumptionModifier,flightTimeToTarget:1,flightTimeBackToOrigin:1}}return{storageModifier:0,consumptionModifier:0,flightTimeToTarget:0,flightTimeBackToOrigin:0}};$(".mSelect").change(function(){const quantumGateMissionModifierType=QuantumGateDeuteriumUse[$(".mSelect:checked").val()];if(void 0===quantumGateMissionModifierType)return;const quantumGateModifiers=getQuantumGateModifiers(quantumGateMissionModifierType);let StorageModif_New=quantumGateModifiers.storageModifier,ConsuptionModif_New=quantumGateModifiers.consumptionModifier,FlyTimeTargetModif=quantumGateModifiers.flightTimeToTarget,FlyTimeBackModif=quantumGateModifiers.flightTimeBackToOrigin;var ConsuptionModif_Old=$("#FuelUse").data("ConsuptionModif_Old"),ConsuptionVar_Now=$("#FuelUse").data("ConsuptionVar_Now");void 0===ConsuptionModif_Old&&(ConsuptionModif_Old=0),void 0===ConsuptionVar_Now&&(ConsuptionVar_Now=parseInt($("#Consumption").val(),10)),isQuantumGateUsed()||(ConsuptionModif_New=0);var ConsuptionModif_Dif=ConsuptionModif_New-ConsuptionModif_Old;0!==ConsuptionModif_Dif&&(ConsuptionVar_Now-=ConsuptionModif_Dif,$("#FuelUse").html(libCommon.format.addDots(ConsuptionVar_Now)),$("#FuelUse").data("ConsuptionModif_Old",ConsuptionModif_New),$("#FuelUse").data("ConsuptionVar_Now",ConsuptionVar_Now));var Changed=!1,StorageModif_Old=$("#FreeStorage").data("StorageModif_Old");void 0===StorageModif_Old&&(StorageModif_Old=0),isQuantumGateUsed()||(StorageModif_New=0);var StorageModif_Dif=StorageModif_New-StorageModif_Old;if(0!==StorageModif_Dif){var FreeStorage=parseInt($("#FreeStorage").val(),10)+StorageModif_Dif;$("#FreeStorage").data("StorageModif_Old",StorageModif_New),Changed=!0}if(Changed){if($("#FreeStorage").val(FreeStorage).setStorageShow(FreeStorage),QuantumGateOptionModif=!0,$("[name=resource3]").change(),LastStorageLowerTh0){LastStorageLowerTh0=!1;var ThisResID="1",NextResID="2";"met"==ResSortArrayNoDeu[0]&&(ThisResID="2",NextResID="1"),$("[name=resource"+ThisResID+"]").change(),LastStorageLowerTh0&&(LastStorageLowerTh0=!1,$("[name=resource"+NextResID+"]").change(),LastStorageLowerTh0=!1)}QuantumGateOptionModif=!1}isQuantumGateUsed()||(FlyTimeBackModif=0,FlyTimeTargetModif=0),FlightDurationTarget=1==FlyTimeTargetModif?1:FlightDuration,FlightDurationGoback=1==FlyTimeBackModif?1:FlightDuration;const flightTimes=[],flightToTargetDuration=uniengine.common.prettyTime({seconds:FlightDurationTarget,isDayConversionDisabled:!0});if(flightTimes.push(flightToTargetDuration),1==FlyTimeTargetModif&&0==FlyTimeBackModif){const flightBackToOriginDuration=uniengine.common.prettyTime({seconds:FlightDurationGoback,isDayConversionDisabled:!0});flightTimes.push(flightBackToOriginDuration),$(".flyTimeInfo").show(),$(".flyTimeNoInfo").hide()}else $(".flyTimeInfo").hide(),$(".flyTimeNoInfo").show();$("#FlightTimeShow").html(flightTimes.join("<br/>"))}),$("#usequantumgate").click(function(){isQuantumGateNeeded()&&$("#noDeutInfo").toggle(!isQuantumGateUsed()),$(".mSelect").change()}),(!isQuantumGateNeeded()||isQuantumGateNeeded()&&isQuantumGateUsed())&&$("#noDeutInfo").hide(),$(".flyTimeInfo").tipTip({delay:0,maxWidth:250,edgeOffset:8,content:JSLang.fl2_FlyTimeInfo}),$(".planet").tipTip({delay:0,edgeOffset:8,content:JSLang.fl_coordplanet}),$(".moon").tipTip({delay:0,edgeOffset:8,content:JSLang.fl_coordmoon}),$(".debris").tipTip({delay:0,edgeOffset:8,content:JSLang.fl_coorddebris}),$(".flyTimeInfo").hide(),$("th:not(.FBlock, .inv, .QuantumInfo), #gTb td").addClass("pad2"),$("#InfoTable").find("th:not(.nfoInv)").addClass("nfoTH"),$("#InfoTable").find("th.inv").addClass("nfoInv"),$("#goBack").click(function(){$("#thisForm").attr("action","fleet1.php").prepend('<input type="hidden" name="gobackUsed" value="1"/>').submit()}),$("#thisForm").submit(function(){const hasUsedGoback=$('[name="gobackUsed"]').length>0,isAllyPackAttackWarnEnabled=!0===AllyPact_AttackWarn;if(hasUsedGoback||!isAllyPackAttackWarnEnabled)return;const currentMissionType=parseInt($('[name="mission"]:checked').val(),10);return aggressiveMissionTypes.includes(currentMissionType)?confirm(JSLang.confirm_allypact_attack):void 0}),!1===SetResources?"1"==$("#quickres").val()&&$("#setMaxAll").click():($('[name="resource1"]').val(SetResources.resource1).change(),$('[name="resource2"]').val(SetResources.resource2).change(),$('[name="resource3"]').val(SetResources.resource3).change()),!0===SelectQuantumGate&&($("#usequantumgate").click(),$(".mSelect").change())});